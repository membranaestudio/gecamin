<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Captura de PDF con jsPDF y html2canvas</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	<style>
		#content-to-capture {
			max-width: 1300px;
			/* Visualización normal limitada a 1000px */
			margin: auto;
		}

		.title {
			color: red;
			font-size: 2vw
		}

		.content {
			color: blue;
			font-size: 2vw
		}
	</style>
</head>

<body>
	<button class="btn btn-primary" onclick="downloadPDF()">Descargar PDF</button>

	<div class="add-pdf-example">
		<p>este una prueba</p>
	</div>

	<div class="add-pdf-example-2">
		<p>este una prueba 2</p>
	</div>


	<div class="container" id="content-to-capture">
		<div class="row">
			<div class="col-6">
				<h2 class="title">Título 1</h2>
				<p class="content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quod, excepturi accusantium
					corporis culpa impedit nihil eaque explicabo quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit. Exercitationem.</p>
			</div>
			<div class="col-6">
				<h2 class="title">Título 1</h2>
				<p class="content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quod, excepturi accusantium
					corporis culpa impedit nihil eaque explicabo quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit. Exercitationem.</p>
			</div>
			<div class="col-6">
				<h2 class="title">Título 1</h2>
				<p class="content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quod, excepturi accusantium
					corporis culpa impedit nihil eaque explicabo quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit. Exercitationem.</p>
			</div>
			<div class="col-6">
				<h2 class="title">Título 1</h2>
				<p class="content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quod, excepturi accusantium
					corporis culpa impedit nihil eaque explicabo quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit. Exercitationem.</p>
			</div>
			
		</div>
		
	</div>

	<div class="container" id="content-to-capture">
		<div class="row">
			<div class="col-6">
				<h2 class="title">Título 2</h2>
				<p class="content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quod, excepturi accusantium
					corporis culpa impedit nihil eaque explicabo quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit. Exercitationem. quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit.  Exercitationem. quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit.d.</p>
		
			</div>
			<div class="col-6">
				<h2 class="title">Título 2</h2>
				<p class="content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quod, excepturi accusantium
					corporis culpa impedit nihil eaque explicabo quibusdam nulla, animi nam commodi ipsa voluptas fugit
					odio cupiditate doloremque suscipit. Exercitationem.</p>
			</div>
		</div>
		
	</div>


	<div class="container" id="content-to-capture">
		
		<div class="row">
			<div class="col-6">
				<h2 class="title">Título 3</h2>
			</div>
			<div class="col-6" data-change-class="col-3">
				<h2 class="title">Título 3</h2>

			</div>
			
		</div>
	</div>

	
<script>
function downloadPDF() {
  const pdfWidth = 1200; // Ancho del PDF
  const pdfHeight = 1600; // Alto del PDF
  const headerHeight = 144; // Altura del encabezado
  const spaceBelowHeader = 50; // Espacio debajo del encabezado
  const pdf = new jspdf.jsPDF({
    orientation: 'portrait',
    unit: 'px',
    format: [pdfWidth, pdfHeight] // Configurar el tamaño de la página
  });
  const containers = document.querySelectorAll('#content-to-capture');
  let currentPageHeight = headerHeight + spaceBelowHeader; // Iniciar después del encabezado y el espacio
  const pageHeight = pdf.internal.pageSize.height - 30; // 30px para padding
  const captureWidth = 1200; // Ancho de la captura
  let promiseChain = Promise.resolve(); // Iniciar una cadena de promesas

  // Función para agregar el encabezado a cada página
  const addHeader = () => {
    return new Promise(resolveHeader => {
      const img = new Image();
      img.src = 'header.png'; // Asegúrate de que la ruta es correcta
      img.onload = () => {
        const imgWidth = pdfWidth; // Usar el ancho completo del PDF para el encabezado
        pdf.addImage(img, 'PNG', 0, 0, imgWidth, headerHeight);
        resolveHeader();
      };
    });
  };

  // Agregar el encabezado inicial
  promiseChain = promiseChain.then(() => addHeader());

  containers.forEach((container) => {
    Array.from(container.querySelectorAll('.row')).forEach(row => {
      promiseChain = promiseChain.then(() => {
        return new Promise((resolveRow) => {
          const clone = row.cloneNode(true);
          // Procesar cambios de clase y contenido aquí
          clone.style.maxWidth = captureWidth + 'px';
          document.body.appendChild(clone);
          html2canvas(clone, { scale: 1.4, width: pdfWidth }).then(canvas => {
            document.body.removeChild(clone);
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = captureWidth; // Ancho de la captura original
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            const marginLeft = (pdfWidth - imgWidth) / 2; // Calcular el margen izquierdo para centrar
            if (currentPageHeight + imgHeight > pageHeight) {
              pdf.addPage();
              currentPageHeight = headerHeight + spaceBelowHeader; // Restablecer altura después del encabezado
              addHeader(); // Agregar encabezado en la nueva página
            }
            pdf.addImage(imgData, 'JPEG', marginLeft, currentPageHeight, imgWidth, imgHeight, undefined, 'FAST');
            currentPageHeight += imgHeight;
            resolveRow();
          });
        });
      });
    });
  });

  promiseChain.then(() => {
    pdf.save('test.pdf'); // Guardar el PDF una vez que todas las promesas se hayan resuelto
  });
}
</script>





</body>

</html>